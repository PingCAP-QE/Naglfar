apiVersion: naglfar.pingcap.com/v1
kind: TestClusterTopology
metadata:
  name: test
  namespace: test
spec:
  resourceRequest: cluster-1
  tidbCluster:
    global:
      deployDir: "/tidb-deploy"
      dataDir: "/tidb-data"
    serverConfigs:
      tidb: |-
        log.slow-threshold: 300
        binlog.enable: false
        binlog.ignore-error: false
      tikv: |-
        readpool.storage.use-unified-pool: false
        readpool.coprocessor.use-unified-pool: true
      pd: |-
        schedule.leader-schedule-limit: 4
        schedule.region-schedule-limit: 2048
        schedule.replica-schedule-limit: 64
    upgradePolicy: force
    version:
      version: nightly
    control: n1
    haProxy:
      host: n5
      port: 9999
      version: latest
      config: |-
        global   # 全局参数的设置
             user haproxy
             group haproxy
             daemon
             nbproc 16
             maxconn 4096

        defaults
             mode http
             retries 3
             option httplog
             option redispatch
             option abortonclose
             option dontlognull
             option httpclose
             contimeout 5000
             clitimeout 3000
             srvtimeout 3000
    tikv:
      - host: n1
        port: 20160
        statusPort: 20180
        deployDir: /disk1/deploy/tikv-20160
        dataDir: /disk1/data/tikv-20160
        logDir: /disk1/deploy/tikv-20160/log
    tidb:
      - host: n1
        deployDir: /disk1/deploy/tidb-4000
        logDir: /disk1/deploy/tidb-4000/log
    pd:
      - host: n1
        deployDir: /disk1/deploy/pd-2379
        dataDir: /disk1/data/pd-2379
        logDir: /disk1/deploy/pd-2379/log
    monitor:
      - host: n1
        deployDir: /disk1/deploy/prometheus-8249
        dataDir: /disk1/deploy/prometheus-8249/data
    grafana:
      - host: n2
        deployDir: /disk1/deploy/grafana-3000
    cdc:
      - host: n1
        port: 8300
        deployDir: /disk1/deploy/cdc
        logDir: /disk1/deploy/cdc
    tiflash:
      - host: n5
        tcpPort: 9000
        httpPort: 8123
        servicePort: 3930
        proxyPort: 20170
        proxyStatusPort: 20292
        metricsPort: 8234
        deployDir: /tidb-deploy/tiflash-9000
        dataDir: /tidb-data/tiflash-9000
        config: |-
          logger.level: info
        learnerConfig: |-
          log-level: info
